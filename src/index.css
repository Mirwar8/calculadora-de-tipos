@import './styles/gba-emulator.css';
@tailwind base;
@tailwind components;
@tailwind utilities;

@layer base {
  body {
    @apply font-display text-slate-900 dark:text-white bg-background-light dark:bg-background-dark;
    zoom: 1;
    -moz-transform: scale(1);
    -moz-transform-origin: 0 0;
    transform-origin: top left;

    /* Fluid typography using clamp() for smooth scaling */
    font-size: clamp(14px, 1.2vw, 20px);

    /* Prevent text zoom distortion */
    text-size-adjust: 100%;
    -webkit-text-size-adjust: 100%;
    -moz-text-size-adjust: 100%;
  }

  /* Fine-tuned breakpoints for better transitions */
  @media (min-width: 768px) {
    body {
      font-size: clamp(15px, 1.1vw, 18px);
    }
  }

  @media (min-width: 1024px) {
    body {
      font-size: clamp(16px, 1vw, 18px);
    }
  }

  @media (min-width: 1440px) {
    body {
      font-size: clamp(17px, 0.9vw, 19px);
    }
  }

  @media (min-width: 1800px) {
    body {
      font-size: clamp(18px, 0.85vw, 20px);
    }
  }

  @media (min-width: 2400px) {
    body {
      font-size: clamp(19px, 0.8vw, 22px);
    }
  }

  @media (min-width: 3840px) {
    body {
      font-size: clamp(20px, 0.7vw, 24px);
    }
  }
}

@layer utilities {
  .line-clamp-1 {
    display: -webkit-box;
    -webkit-line-clamp: 1;
    -webkit-box-orient: vertical;
    overflow: hidden;
  }

  .responsive-container {
    container-type: inline-size;
  }
}

@layer components {
  .matrix-cell {
    @apply min-w-11 h-11 flex items-center justify-center text-xs font-bold transition-colors;
  }

  /* Responsive matrix cells - más compactas para Team Builder */
  @media (min-width: 768px) {
    .matrix-cell {
      @apply min-w-10 h-10 text-xs;
    }
  }

  @media (min-width: 1024px) {
    .matrix-cell {
      @apply min-w-11 h-11 text-xs;
    }
  }

  @media (min-width: 1440px) {
    .matrix-cell {
      @apply min-w-12 h-12 text-sm;
    }
  }

  .type-badge {
    @apply px-2 py-0.5 rounded text-[0.65rem] uppercase font-bold text-white shadow-sm;
  }

  /* Responsive type badges */
  @media (min-width: 768px) {
    .type-badge {
      @apply px-3 py-1 text-xs;
    }
  }

  @media (min-width: 1024px) {
    .type-badge {
      @apply px-3 py-1.5 text-sm;
    }
  }

  .type-icon {
    @apply size-7 rounded-sm flex items-center justify-center text-[10px] font-bold text-white shadow-sm shrink-0 uppercase;
  }

  /* Responsive type icons - más compactos para Team Builder */
  @media (min-width: 768px) {
    .type-icon {
      @apply size-7 text-xs;
    }
  }

  @media (min-width: 1024px) {
    .type-icon {
      @apply size-8 text-xs;
    }
  }

  @media (min-width: 1440px) {
    .type-icon {
      @apply size-9 text-sm;
    }
  }

  .offensive-badge-x2 {
    @apply size-7 rounded-full bg-green-500/90 flex items-center justify-center text-white font-bold text-[10px] shadow-sm;
  }

  /* Responsive offensive badges - más compactos para Team Builder */
  @media (min-width: 768px) {
    .offensive-badge-x2 {
      @apply size-7 text-xs;
    }
  }

  @media (min-width: 1024px) {
    .offensive-badge-x2 {
      @apply size-8 text-xs;
    }
  }

  .offensive-badge-x4 {
    @apply size-7 rounded-full bg-orange-600 flex items-center justify-center text-white font-bold text-[10px] border border-orange-400/30 shadow-sm;
  }

  @media (min-width: 768px) {
    .offensive-badge-x4 {
      @apply size-7 text-xs;
    }
  }

  @media (min-width: 1024px) {
    .offensive-badge-x4 {
      @apply size-8 text-xs;
    }
  }

  .matrix-header-cell {
    @apply p-1 border-r border-slate-200 dark:border-[#233648] last:border-r-0;
  }

  @media (min-width: 768px) {
    .matrix-header-cell {
      @apply p-2;
    }
  }

  @media (min-width: 1024px) {
    .matrix-header-cell {
      @apply p-3;
    }
  }
}

/* Fluid typography utilities */
@layer utilities {
  .text-fluid-xs {
    font-size: clamp(0.625rem, 0.8vw, 0.75rem);
  }

  .text-fluid-sm {
    font-size: clamp(0.75rem, 1vw, 0.875rem);
  }

  .text-fluid-base {
    font-size: clamp(0.875rem, 1.2vw, 1rem);
  }

  .text-fluid-lg {
    font-size: clamp(1rem, 1.4vw, 1.125rem);
  }

  .text-fluid-xl {
    font-size: clamp(1.125rem, 1.6vw, 1.25rem);
  }

  .text-fluid-2xl {
    font-size: clamp(1.25rem, 1.8vw, 1.5rem);
  }

  .text-fluid-3xl {
    font-size: clamp(1.5rem, 2.2vw, 2rem);
  }

  .text-fluid-4xl {
    font-size: clamp(1.875rem, 2.6vw, 2.5rem);
  }

  .text-fluid-5xl {
    font-size: clamp(2.25rem, 3vw, 3rem);
  }

  .text-fluid-6xl {
    font-size: clamp(2.5rem, 3.4vw, 3.5rem);
  }

  /* Responsive spacing utilities */
  .space-fluid-2 {
    gap: clamp(0.5rem, 1vw, 1rem);
  }

  .space-fluid-4 {
    gap: clamp(1rem, 1.5vw, 1.5rem);
  }

  .space-fluid-6 {
    gap: clamp(1.5rem, 2vw, 2rem);
  }

  .space-fluid-8 {
    gap: clamp(2rem, 2.5vw, 3rem);
  }
}

.zebra-table tbody tr:nth-child(even) {
  @apply bg-slate-50 dark:bg-[#101922];
}

.pokemon-card {
  content-visibility: auto;
  contain-intrinsic-size: 1px 400px;
  /* Estimated height of a card */
  transition: opacity 0.2s ease-in-out;
}

/* Simplify UI during fast scrubbing to maintain 60FPS */
.is-scrubbing .pokemon-card img,
.is-scrubbing .pokemon-card .mt-auto,
.is-scrubbing .pokemon-card .flex-wrap {
  opacity: 0;
  pointer-events: none;
}

.is-scrubbing .pokemon-card {
  @apply bg-slate-50 dark:bg-[#1a2632] border-transparent shadow-none;
}

@keyframes fade-in {
  from {
    opacity: 0;
  }

  to {
    opacity: 1;
  }
}

@keyframes scale-in {
  from {
    opacity: 0;
    transform: scale(0.95);
  }

  to {
    opacity: 1;
    transform: scale(1);
  }
}

@keyframes slide-in-bottom {
  from {
    transform: translateY(100%);
  }

  to {
    transform: translateY(0);
  }
}

@keyframes slide-in-left {
  from {
    transform: translateX(-100%);
  }

  to {
    transform: translateX(0);
  }
}

.animate-fade-in {
  animation: fade-in 0.3s ease-out forwards;
}

.animate-scale-in {
  animation: scale-in 0.3s cubic-bezier(0.16, 1, 0.3, 1) forwards;
}

.animate-slide-in-bottom {
  animation: slide-in-bottom 0.4s cubic-bezier(0.16, 1, 0.3, 1) forwards;
}

.animate-slide-in-left {
  animation: slide-in-left 0.4s cubic-bezier(0.16, 1, 0.3, 1) forwards;
}

/* Custom scrollbar for matrix and dropdowns */
.custom-scrollbar::-webkit-scrollbar {
  height: 8px;
  width: 8px;
}

.pixelated {
  image-rendering: pixelated;
}

.quick-nav-rail {
  @apply fixed right-0 top-[10%] bottom-[10%] w-8 z-[60] flex flex-col items-center select-none touch-none;
  contain: strict;
}

.scrubber-track {
  @apply absolute right-1.5 top-0 bottom-0 w-1.5 bg-slate-200/20 dark:bg-white/10 backdrop-blur-md rounded-full border border-white/10;
  will-change: transform;
}

.scrubber-thumb {
  @apply absolute right-1 w-2.5 h-12 bg-primary rounded-full shadow-lg transition-transform active:scale-110;
  transform: translateY(-50%);
  will-change: transform, top;
}

.scrubber-label {
  @apply absolute right-8 px-2 py-1 bg-primary text-white text-[10px] font-black rounded-lg shadow-xl opacity-0 transition-opacity pointer-events-none;
  transform: translateY(-50%);
  will-change: transform, top, opacity;
}

.quick-nav-rail:active .scrubber-label {
  @apply opacity-100;
}

.scroll-top-btn {
  @apply fixed bottom-6 right-6 z-[60] size-12 bg-primary text-white rounded-full flex items-center justify-center shadow-xl transition-all duration-300 scale-0 opacity-0 active:scale-95;
}

.scroll-top-btn.visible {
  @apply scale-100 opacity-100;
}

.custom-scrollbar::-webkit-scrollbar-track {
  background: transparent;
}

.custom-scrollbar::-webkit-scrollbar-thumb {
  background: #cbd5e1;
  border-radius: 4px;
}

.dark .custom-scrollbar::-webkit-scrollbar-track {
  background: #1A1A1A;
}

.dark .custom-scrollbar::-webkit-scrollbar-thumb {
  background: #333333;
}

/* Enhanced responsive container utilities */
@layer utilities {
  .responsive-container {
    container-type: inline-size;
  }

  /* Container query utilities */
  @container (min-width: 320px) {
    .container-sm {
      /* Styles for small containers */
    }
  }

  @container (min-width: 768px) {
    .container-md {
      /* Styles for medium containers */
    }
  }

  @container (min-width: 1024px) {
    .container-lg {
      /* Styles for large containers */
    }
  }
}

/* Breakpoint-specific grid utilities */
@layer utilities {
  .grid-responsive {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(max(250px, 40vw), 400px));
    gap: clamp(1rem, 2vw, 2rem);
  }

  .grid-tight {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(max(200px, 35vw), 350px));
    gap: clamp(0.75rem, 1.5vw, 1.5rem);
  }

  .grid-wide {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(max(300px, 45vw), 500px));
    gap: clamp(1.5rem, 2.5vw, 3rem);
  }
}

/* Prevent layout shift during loading */
@layer base {
  img {
    aspect-ratio: attr(width) / attr(height);
  }

  /* Maintain aspect ratios for common media */
  .aspect-pokemon {
    aspect-ratio: 1;
  }

  .aspect-sprite {
    aspect-ratio: 1;
  }

  .aspect-card {
    aspect-ratio: 4/3;
  }
}

/* Enhanced touch targets for mobile */
@layer utilities {
  .touch-target {
    min-height: 44px;
    min-width: 44px;
  }

  @media (pointer: coarse) {
    .touch-target {
      min-height: 48px;
      min-width: 48px;
    }
  }
}

/* Zoom stability improvements */
@layer base {

  /* Prevent horizontal scroll on zoom */
  html,
  body {
    overflow-x: hidden;
    width: 100%;
    margin: 0;
    padding: 0;
    -webkit-overflow-scrolling: touch;
  }

  /* Universal box sizing fix for mobile */
  *,
  *::before,
  *::after {
    box-sizing: border-box;
  }

  /* Utility for scrolling without breaking layouts */
  .overflow-safe {
    overflow-x: auto;
    overflow-y: hidden;
    -webkit-overflow-scrolling: touch;
    max-width: 100%;
  }
}

/* Pokédex Hardware UI Components */
@layer components {
  .shadow-bevel {
    box-shadow:
      0 10px 15px -3px rgba(0, 0, 0, 0.3),
      inset 0 2px 4px 0 rgba(255, 255, 255, 0.1),
      inset 0 -4px 6px -1px rgba(0, 0, 0, 0.2);
  }

  .shadow-bevel-pressed {
    box-shadow:
      inset 0 4px 6px -1px rgba(0, 0, 0, 0.3),
      inset 0 2px 4px 0 rgba(0, 0, 0, 0.1);
  }

  .shadow-inner-heavy {
    box-shadow: inset 0 8px 16px -4px rgba(0, 0, 0, 0.5);
  }

  .lens-reflection {
    position: relative;
    overflow: hidden;
  }

  .lens-reflection::before {
    content: '';
    position: absolute;
    top: 10%;
    left: 15%;
    width: 40%;
    height: 30%;
    background: linear-gradient(135deg, rgba(255, 255, 255, 0.4) 0%, rgba(255, 255, 255, 0) 100%);
    border-radius: 50%;
    filter: blur(2px);
  }

  .scanlines {
    background: linear-gradient(to bottom,
        rgba(18, 16, 16, 0) 50%,
        rgba(0, 0, 0, 0.1) 50%);
    background-size: 100% 4px;
    z-index: 10;
    pointer-events: none;
  }
}